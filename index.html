<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Website Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:2rem;max-width:1100px}
    h1{margin:0 0 1rem}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
    textarea{width:100%;min-height:140px;padding:.8rem;font-size:1rem}
    button{padding:.7rem 1rem;font-size:1rem;cursor:pointer}
    .row{display:flex;gap:.5rem;align-items:center;margin:.5rem 0 1rem;flex-wrap:wrap}
    .presets{display:flex;gap:.5rem;flex-wrap:wrap}
    .preset{border:1px solid #ddd;background:#fafafa;border-radius:8px}
    iframe{width:100%;height:520px;border:1px solid #ddd;border-radius:8px}
    pre{background:#111;color:#eee;padding:1rem;border-radius:8px;white-space:pre-wrap;max-height:28rem;overflow:auto}
    .tabs{display:flex;gap:.5rem;margin:.5rem 0}
    .tabs button{border:1px solid #ccc;background:#fafafa}
    .code{display:none}
    .code.active{display:block}
  </style>
</head>
<body>
  <h1>ðŸ§ª Website Generator</h1>

  <div class="grid">
    <div>
      <label for="spec"><b>Describe the site you want:</b></label>
      <textarea id="spec" placeholder="Example: A SaaS landing page with a hero, features grid, pricing, and a footer. Use a blue/purple gradient."></textarea>

      <!-- Preset prompt buttons -->
      <div class="presets">
        <button class="preset" data-prompt="SaaS landing page for â€˜FocusFlowâ€™. Hero with headline + two CTAs, 3-feature grid with icons, testimonial card, pricing (Free/Pro), minimal footer. Blueâ†’purple gradient. Mobile-first.">SaaS</button>
        <button class="preset" data-prompt="Personal portfolio for web developer Kenny. Sticky nav (Home, Projects, About, Contact), hero with name + tagline, 6-card projects grid, skills badges (JS/Node/React), contact form. Neutral light theme, subtle shadows.">Portfolio</button>
        <button class="preset" data-prompt="Modern restaurant homepage for â€˜Ember & Thymeâ€™. Full-width hero with image overlay + reservation CTA, 3-column story/dishes/location, 4-card menu preview, footer with hours + socials. Warm palette, serif headings.">Restaurant</button>
        <button class="preset" data-prompt="Simple e-commerce grid (8 items) for â€˜GlowGearâ€™. Header with logo + cart counter, search input, 4-col product grid (image, name, price, Add to Cart), footer. Black/white high-contrast with neon accent. Add fake cart count in JS.">E-com</button>
      </div>

      <div class="row">
        <button id="gen">Generate</button>
        <button id="download" disabled>Download .zip</button>
      </div>

      <div class="tabs">
        <button data-tab="html">HTML</button>
        <button data-tab="css">CSS</button>
        <button data-tab="js">JS</button>
      </div>
      <pre id="html" class="code"></pre>
      <pre id="css" class="code"></pre>
      <pre id="js" class="code"></pre>
    </div>

    <div>
      <b>Live Preview</b>
      <iframe id="preview"></iframe>
    </div>
  </div>

  <script type="module">
    let current = { html: "", css: "", js: "" };

    const $ = (q) => document.querySelector(q);
    const spec = $("#spec");
    const btnGen = $("#gen");
    const btnZip = $("#download");
    const frame = $("#preview");
    const htmlBox = $("#html");
    const cssBox = $("#css");
    const jsBox  = $("#js");

    // Tabs
    document.querySelectorAll(".tabs button").forEach(b=>{
      b.onclick = ()=>{
        document.querySelectorAll(".code").forEach(c=>c.classList.remove("active"));
        $("#"+b.dataset.tab).classList.add("active");
      };
    });
    htmlBox.classList.add("active");

    // Presets
    document.querySelectorAll(".preset").forEach(p=>{
      p.onclick = ()=>{
        spec.value = p.dataset.prompt;
        spec.focus();
      };
    });

    btnGen.onclick = async () => {
      btnGen.disabled = true;
      btnGen.textContent = "Generatingâ€¦";
      btnZip.disabled = true;

      try {
        const res = await fetch("http://localhost:3000/generate", {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({ prompt: spec.value || "A simple portfolio with hero, projects grid, and contact form." })
        });
        if (!res.ok) {
          const t = await res.text();
          throw new Error(`HTTP ${res.status} â€“ ${t}`);
        }
        const data = await res.json();
        current = { html: data.html ?? "", css: data.css ?? "", js: data.js ?? "" };

        // show code
        htmlBox.textContent = current.html;
        cssBox.textContent  = current.css;
        jsBox.textContent   = current.js;

        // render preview: compose a full HTML doc with inline <style> and <script>
        const doc = `
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="style.css">
<style>${current.css}</style>
</head>
<body>
${current.html}
<script>${current.js}</script>
</body>
</html>`;
        frame.srcdoc = doc;

        btnZip.disabled = false;
        btnGen.textContent = "Generate";
        btnGen.disabled = false;
      } catch (e) {
        alert("Generation failed: " + e.message);
        btnGen.textContent = "Generate";
        btnGen.disabled = false;
      }
    };

    // Build a .zip with index.html/style.css/script.js (store method)
    btnZip.onclick = async () => {
      const files = {
        "index.html": `<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="style.css">
<title>Generated Site</title>
</head>
<body>
${current.html}
<script src="script.js"></script>
</body>
</html>`,
        "style.css": current.css,
        "script.js": current.js
      };

      const enc = new TextEncoder();
      const fileEntries = [];
      let offset = 0;
      const parts = [];

      function crc32(str){
        let c = ~0;
        for (let i = 0; i < str.length; i++){
          c = (c ^ str.charCodeAt(i)) >>> 0;
          for (let k = 0; k < 8; k++){
            c = (c & 1) ? (0xEDB88320 ^ (c >>> 1)) : (c >>> 1);
          }
        }
        return (~c) >>> 0;
      }

      // local file headers + file data
      for (const [name, content] of Object.entries(files)) {
        const bytes = enc.encode(content);
        const nameBytes = enc.encode(name);
        const crc = crc32(content);

        const local = new Uint8Array(30 + nameBytes.length);
        const dv = new DataView(local.buffer);
        dv.setUint32(0, 0x04034b50, true);   // local header sig
        dv.setUint16(4, 20, true);           // ver needed
        dv.setUint16(6, 0, true);            // flags
        dv.setUint16(8, 0, true);            // compression: store
        dv.setUint16(10, 0, true);           // mod time
        dv.setUint16(12, 0, true);           // mod date
        dv.setUint32(14, crc, true);         // CRC-32
        dv.setUint32(18, bytes.length, true);// comp size
        dv.setUint32(22, bytes.length, true);// uncomp size
        dv.setUint16(26, nameBytes.length, true);
        dv.setUint16(28, 0, true);           // extra len
        local.set(nameBytes, 30);

        parts.push(local, bytes);
        fileEntries.push({ nameBytes, crc, size: bytes.length, offset });
        offset += local.length + bytes.length;
      }

      // central directory
      const centralParts = [];
      let centralSize = 0;
      for (const e of fileEntries) {
        const header = new Uint8Array(46 + e.nameBytes.length);
        const dv = new DataView(header.buffer);
        dv.setUint32(0, 0x02014b50, true);   // central header sig
        dv.setUint16(4, 20, true);           // ver made
        dv.setUint16(6, 20, true);           // ver needed
        dv.setUint16(8, 0, true);            // flags
        dv.setUint16(10, 0, true);           // compression
        dv.setUint16(12, 0, true);           // mod time
        dv.setUint16(14, 0, true);           // mod date
        dv.setUint32(16, e.crc, true);       // CRC-32
        dv.setUint32(20, e.size, true);      // comp size
        dv.setUint32(24, e.size, true);      // uncomp size
        dv.setUint16(28, e.nameBytes.length, true);
        dv.setUint16(30, 0, true);           // extra
        dv.setUint16(32, 0, true);           // comment
        dv.setUint16(34, 0, true);           // disk num
        dv.setUint16(36, 0, true);           // internal attrs
        dv.setUint32(38, 0, true);           // external attrs
        dv.setUint32(42, e.offset, true);    // rel offset
        header.set(e.nameBytes, 46);

        centralParts.push(header);
        centralSize += header.length;
      }

      // end of central directory
      const end = new Uint8Array(22);
      const dvEnd = new DataView(end.buffer);
      dvEnd.setUint32(0, 0x06054b50, true);
      dvEnd.setUint16(4, 0, true);
      dvEnd.setUint16(6, 0, true);
      dvEnd.setUint16(8, fileEntries.length, true);
      dvEnd.setUint16(10, fileEntries.length, true);
      dvEnd.setUint32(12, centralSize, true);
      dvEnd.setUint32(16, offset, true);
      dvEnd.setUint16(20, 0, true);

      const blob = new Blob([...parts, ...centralParts, end], { type: "application/zip" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "generated-site.zip";
      link.click();
      URL.revokeObjectURL(link.href);
    };
  </script>
</body>
</html>
